# Telegram бот погоды Череповца

Адрес бота: [@weather35bot](https://t.me/weather35bot)

## Что позволяет бот

- Узнать текущую погоду
- Узнать прогноз на конкретный час (в пределах следующих двух дней)
- Узнать прогноз на конкретный день (в пределах следующих семи дней)
- **Подписаться на ежедневную рассылку в удобное для вас время**

Прогноз на конкретный час состоит из типа погоды, фактической и ощущаемой температур, скорости ветра (и порывов, если присутствуют), показателя влажности, показателя облачности, и предупреждений (если присутствуют).

Прогноз на конкретный день дополняется информацией о температуре каждого времени суток - утра, дня, вечера, и ночи.

## Использование

Начните диалог с ботом [@weather35bot](https://t.me/weather35bot).

Вся работа с ним будет происходить при помощи клавиатуры, которую бот выдаст вместе с его первым сообщением. В этом сообщении будет описано, за что отвечает каждая кнопка клавиатуры.

Теперь вы можете узнать текущую погоду, получить прогноз, и подписаться на рассылку.

## Мотивация

- Хотелось без лишних усилий получать подробную информацию о текущей погоде.

Поэтому я выбрал Telegram. Простой интерфейс, автоматическая рассылка. Можно один раз настроить, и бот сам будет отправлять прогноз.

- Хотелось иметь небольшой проект для практикования.

Периодически я возвращаюсь к этому проекту с целью улучшения кода, структуры, презентации и т.д. Об этих рефакторингах можно прочитать [здесь](https://github.com/Masynchin/history) под заголовками, содержащими "CheWeatherBot".

## Реализация

CheWeatherBot -  Telegram-бот на Python. Для получения информации о погоде используется [OpenWeatherMap](https://openweathermap.org/) с тарифом [One Call API](https://openweathermap.org/api/one-call-api).

Бот работает на Heroku. Принимает сообщения через вебхук. Чтобы Heroku не выключал бота, подключен [Heroku Kaffeine](https://kaffeine.herokuapp.com).

Подписчики хранятся в [PostgreSQL](https://elements.heroku.com/addons/heroku-postgresql).

### Технологии

#### Бот

- Для работы с telegram используется [aiogram](https://github.com/aiogram/aiogram).
- Для логирования используется [loguru](https://github.com/Delgan/loguru).

#### Работа с [OpenWeatherMap](https://openweathermap.org/)

- Для запросов к API используется [aiohttp](https://github.com/aio-libs/aiohttp).
- Для удобной работы с ответом API используется [pydantic](https://github.com/samuelcolvin/pydantic).

#### Хранение подписчиков рассылки

При разработке используется не PostgreSQL, а SQLite. Поэтому для однородности кода выбрана ORM [sqlalchemy](https://github.com/sqlalchemy/sqlalchemy).

## Установка и запуск

### Зависимости

Зависимости ставятся через:

~~~shell
pip install -r requirements.txt
~~~

Зависимости для разработки (включают обычные зависимости) ставятся через:

~~~shell
pip install -r requirements-dev.txt
~~~

### Переменные окружения

- `BOT_TOKEN` - токен telegram бота
- `WEATHER_API_KEY` - ключ с сайта openweathermap.org (тариф One Call API)
- `DATABASE_URL` - путь к базе данных (по умолчанию `sqlite+aiosqlite:///db/subscribers.db`)

### Запуск

Запуск бота происходит через:

~~~shell
python -m app
~~~

### Логирование

Логи выводятся в консоль, а также сохраняются в папку logs (еженедельная ротация).
В файл undefined_weather_types.txt сохраняются типы погод, для которых нет стикера.
